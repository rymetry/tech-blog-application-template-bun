@reference "../globals.css";

.prose {
  @apply max-w-none;
  --rehype-code-gutter-width: 3.5rem;
  --rehype-code-gutter-pad-left: 0.5rem;
  --rehype-code-gutter-pad-right: 0.75rem;
  --rehype-code-gutter-total: calc(
    var(--rehype-code-gutter-width) + var(--rehype-code-gutter-pad-left) + var(--rehype-code-gutter-pad-right)
  );
}

.prose img {
  @apply mx-auto my-6 rounded-lg sm:my-8 md:my-10 lg:my-12;
}

.prose table {
  @apply block w-full overflow-x-auto;
  max-width: 100%;
  border-collapse: collapse;
  -webkit-overflow-scrolling: touch;
}

.prose iframe {
  @apply block w-full max-w-full;
}

/* コードブロックのスタイル */
.prose pre {
  @apply relative my-6 overflow-hidden rounded-lg border border-white/10 bg-slate-800 p-0 dark:bg-slate-950 sm:my-8 md:my-10;
}

.prose pre[class*='language-'] {
  @apply m-0 overflow-x-auto;
  padding: 1rem 1rem 1rem var(--rehype-code-gutter-total); /* 上 右 下 左（行番号のスペース） */
}

.prose pre.line-numbers {
  counter-reset: linenumber;
}

/* 行番号エリア */
.prose .line-numbers-rows {
  @apply absolute left-0 top-0 select-none border-r border-white/10 text-right;
  width: var(--rehype-code-gutter-width);
  padding: 1rem var(--rehype-code-gutter-pad-right) 1rem var(--rehype-code-gutter-pad-left); /* 上 右 下 左 */
  pointer-events: none;
  background: rgb(0 0 0 / 0.2);
  user-select: none;
}

.prose .line-numbers-rows > span {
  @apply block text-gray-500 dark:text-gray-600;
  font-family:
    var(--font-mono),
    ui-monospace,
    'SF Mono',
    'Cascadia Code',
    'Consolas',
    'Liberation Mono',
    monospace;
  font-weight: 400;
  font-size: 0.875rem;
  line-height: 1.6; /* pre 内のコード行と統一 */
}

.prose .line-numbers-rows > span::before {
  counter-increment: linenumber;
  content: counter(linenumber);
}

/* rehype-prism-plus が生成するクラスのスタイルをリセット */
.prose pre .code-line {
  display: inline;
  background: transparent !important;
}

.prose pre .code-highlight {
  background: transparent !important;
}

/* 特定の行をハイライトする場合のスタイル（必要に応じて使用） */
.prose pre .code-line.highlight-line {
  display: block;
  margin: 0 -1rem;
  padding: 0 1rem;
  background: rgb(255 255 255 / 0.1) !important;
}

/* コードタイトル（ファイル名/言語名） */
.prose .rehype-code-title {
  @apply rounded-t-lg border border-b-0 border-white/10 bg-slate-200/80 px-4 py-2 font-mono text-xs text-slate-700 dark:bg-gray-900 dark:text-gray-300 sm:px-5 sm:py-2.5 sm:text-sm md:px-6;
  margin-bottom: 0;
  font-weight: 400;
}

.prose .rehype-code-title + pre {
  @apply mt-0 rounded-t-none border-t-0;
}

/* インラインコード */
.prose code {
  @apply rounded bg-rose-50 px-1.5 py-0.5 text-rose-600 dark:bg-rose-900/30 dark:text-rose-300;
  font-family:
    var(--font-mono),
    ui-monospace,
    'SF Mono',
    'Cascadia Code',
    'Consolas',
    'Liberation Mono',
    monospace;
  font-weight: 400;
  font-size: 0.9em;
  letter-spacing: -0.005em;
}

/* Tailwind Typographyが追加するバッククォートを削除 */
.prose :where(code):not(:where([class~='not-prose'], [class~='not-prose'] *))::before,
.prose :where(code):not(:where([class~='not-prose'], [class~='not-prose'] *))::after {
  content: none !important;
}

.prose pre code {
  @apply bg-transparent p-0;
  font-family:
    var(--font-mono),
    ui-monospace,
    'SF Mono',
    'Cascadia Code',
    'Consolas',
    'Liberation Mono',
    monospace;
  font-weight: 400;
  font-size: 0.875rem;
  line-height: 1.6; /* 日本語対応: 行間を広めに */
  letter-spacing: -0.01em;
  color: inherit;
}

/* Prism トークンのカラーリング（ライトモード） */
.prose .token.comment,
.prose .token.prolog,
.prose .token.doctype,
.prose .token.cdata {
  color: #6a9955;
}

.prose .token.punctuation {
  color: #d4d4d4;
}

.prose .token.property,
.prose .token.tag,
.prose .token.boolean,
.prose .token.number,
.prose .token.constant,
.prose .token.symbol,
.prose .token.deleted {
  color: #b5cea8;
}

.prose .token.selector,
.prose .token.attr-name,
.prose .token.string,
.prose .token.char,
.prose .token.builtin,
.prose .token.inserted {
  color: #ce9178;
}

.prose .token.operator,
.prose .token.entity,
.prose .token.url,
.prose .language-css .token.string,
.prose .style .token.string {
  color: #d4d4d4;
}

.prose .token.atrule,
.prose .token.attr-value,
.prose .token.keyword {
  color: #c586c0;
}

.prose .token.function,
.prose .token.class-name {
  color: #dcdcaa;
}

.prose .token.regex,
.prose .token.important,
.prose .token.variable {
  color: #d16969;
}

/* ダークモード用の調整 */
.dark .prose .token.comment,
.dark .prose .token.prolog,
.dark .prose .token.doctype,
.dark .prose .token.cdata {
  color: #7c9d7c;
}

.dark .prose .token.punctuation {
  color: #d4d4d4;
}

.dark .prose .token.property,
.dark .prose .token.tag,
.dark .prose .token.boolean,
.dark .prose .token.number,
.dark .prose .token.constant,
.dark .prose .token.symbol,
.dark .prose .token.deleted {
  color: #b5cea8;
}

.dark .prose .token.selector,
.dark .prose .token.attr-name,
.dark .prose .token.string,
.dark .prose .token.char,
.dark .prose .token.builtin,
.dark .prose .token.inserted {
  color: #ce9178;
}

.dark .prose .token.operator,
.dark .prose .token.entity,
.dark .prose .token.url,
.dark .prose .language-css .token.string,
.dark .prose .style .token.string {
  color: #d4d4d4;
}

.dark .prose .token.atrule,
.dark .prose .token.attr-value,
.dark .prose .token.keyword {
  color: #c586c0;
}

.dark .prose .token.function,
.dark .prose .token.class-name {
  color: #dcdcaa;
}

.dark .prose .token.regex,
.dark .prose .token.important,
.dark .prose .token.variable {
  color: #d16969;
}

.prose a {
  @apply font-medium underline underline-offset-4;
  color: color-mix(in srgb, var(--primary) 85%, var(--foreground));
}

.dark .prose a {
  color: color-mix(in srgb, var(--primary) 70%, white);
}

.prose blockquote {
  @apply border-l-4 border-muted pl-4 italic;
}

.prose ul,
.prose ol {
  @apply my-4 ml-6 sm:my-5 md:my-6 lg:my-8;
}

.prose h2,
.prose h3,
.prose h4 {
  @apply mb-3 mt-6 font-semibold sm:mb-4 sm:mt-8 md:mb-5 md:mt-10 lg:mt-12;
}

.editorial-scope .prose h2[id],
.editorial-scope .prose h3[id] {
  scroll-margin-top: var(--article-toc-scroll-offset);
}

.prose p {
  @apply mb-4 text-sm leading-relaxed sm:mb-5 sm:text-base md:mb-6 md:text-base lg:mb-8 lg:text-base;
}

@layer components {
  .editorial-scope .article-hero-compact {
    @apply text-center;
  }

  .editorial-scope .article-hero-cover-compact {
    @apply h-[100px] w-[100px] rounded-2xl border border-border/40 bg-card/70 shadow-sm;
  }

  .editorial-scope .article-hero-cover-placeholder {
    @apply flex items-center justify-center bg-gradient-to-br from-secondary/60 to-background text-muted-foreground;
  }

  .editorial-scope .article-compact-card {
    @apply border border-border/40 bg-card/60 shadow-sm;
  }

  .editorial-scope .article-compact-card-media {
    @apply h-[100px] w-[100px] rounded-xl border border-border/30;
  }

  .editorial-scope .article-toc-panel {
    @apply rounded-2xl border border-border/40 bg-card/60 p-4 shadow-sm backdrop-blur-sm lg:overflow-y-auto;
    max-height: calc(100vh - var(--article-toc-sticky-top) - 1rem);
  }

  .editorial-scope .article-toc-link {
    @apply relative block rounded-md py-1.5 pr-2 pl-4 text-xs text-muted-foreground transition-colors hover:bg-secondary/60 hover:text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 sm:text-[13px];
  }

  .editorial-scope .article-toc-link-active {
    @apply bg-primary/10 text-primary;
  }

  .editorial-scope .article-toc-indent-h3 {
    @apply ml-3 text-[11px] sm:text-xs;
  }

  .editorial-scope .article-toc-segment {
    @apply absolute left-1.5 top-1/2 -translate-y-1/2 rounded-full transition-all duration-200;
  }

  .editorial-scope .article-toc-segment-done {
    @apply h-4 w-[3px] bg-primary/65;
  }

  .editorial-scope .article-toc-segment-current {
    @apply h-5 w-[4px] bg-primary ring-1 ring-primary/30;
  }

  .editorial-scope .article-toc-segment-upcoming {
    @apply h-[14px] w-[3px] bg-muted-foreground/35;
  }

}
